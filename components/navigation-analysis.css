/* ===========================================
   POSITIONING ANALYSIS & SOLUTIONS
   =========================================== */

/* CURRENT ISSUE ANALYSIS:
   Both nav-container and mobile-dropdown use position: fixed,
   creating separate stacking contexts and rendering boundaries.
   This causes inconsistent backdrop-filter application.
*/

/* SOLUTION 1: Relative positioning for mobile-dropdown */
.nav-container-solution-1 {
  /* Keep nav-container as fixed */
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  width: 100vw !important;
  z-index: 9999 !important;

  /* Glass morphism background */
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(20px) saturate(150%) brightness(110%);
  -webkit-backdrop-filter: blur(20px) saturate(150%) brightness(110%);

  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 4px 16px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;

  padding: 24px;
  margin: 16px;

  /* Create containing block for children */
  transform: translateZ(0);
  will-change: backdrop-filter;
}

.mobile-dropdown-solution-1 {
  /* CHANGE: Use absolute positioning relative to nav-container */
  position: absolute !important;
  top: calc(100% + 8px) !important; /* Position below nav-container */
  right: 0 !important;
  z-index: 1 !important; /* Relative to parent, not viewport */

  /* Inherit and enhance parent's blur context */
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.45) 0%, rgba(0, 0, 0, 0.35) 50%, rgba(0, 0, 0, 0.45) 100%);
  backdrop-filter: blur(28px) saturate(180%) brightness(110%) contrast(120%);
  -webkit-backdrop-filter: blur(28px) saturate(180%) brightness(110%) contrast(120%);

  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 12px;
  box-shadow: 0 8px 40px rgba(0, 0, 0, 0.7), 0 4px 20px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;

  padding: 16px;
  min-width: 160px;
  width: max-content;
  overflow: hidden;

  transform: translateZ(0);
  will-change: backdrop-filter, transform;
}

/* SOLUTION 2: Shared stacking context */
.nav-container-solution-2 {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  width: 100vw !important;
  z-index: 9999 !important;

  /* Create isolation context for consistent rendering */
  isolation: isolate;

  /* Glass morphism background */
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(20px) saturate(150%) brightness(110%);
  -webkit-backdrop-filter: blur(20px) saturate(150%) brightness(110%);

  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 4px 16px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;

  padding: 24px;
  margin: 16px;

  transform: translateZ(0);
  will-change: backdrop-filter;
}

.mobile-dropdown-solution-2 {
  position: absolute !important;
  top: calc(100% + 8px) !important;
  right: 0 !important;
  z-index: 1 !important;

  /* Match parent's backdrop-filter context */
  background: rgba(0, 0, 0, 0.4);
  backdrop-filter: inherit; /* Inherit from parent */
  -webkit-backdrop-filter: inherit;

  /* Additional blur layer */
  filter: blur(0.5px); /* Subtle additional blur */

  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 12px;
  box-shadow: 0 8px 40px rgba(0, 0, 0, 0.7), 0 4px 20px rgba(0, 0, 0, 0.5);

  padding: 16px;
  min-width: 160px;
  width: max-content;
  overflow: hidden;
}

/* SOLUTION 3: Portal-based positioning with shared context */
.nav-container-solution-3 {
  position: fixed !important;
  top: 0 !important;
  left: 0 !important;
  right: 0 !important;
  width: 100vw !important;
  z-index: 9999 !important;

  /* Glass morphism background */
  background: rgba(255, 255, 255, 0.1);
  backdrop-filter: blur(20px) saturate(150%) brightness(110%);
  -webkit-backdrop-filter: blur(20px) saturate(150%) brightness(110%);

  border: 1px solid rgba(255, 255, 255, 0.2);
  border-radius: 16px;
  box-shadow: 0 8px 32px rgba(0, 0, 0, 0.3), 0 4px 16px rgba(0, 0, 0, 0.2), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;

  padding: 24px;
  margin: 16px;

  transform: translateZ(0);
  will-change: backdrop-filter;
}

.mobile-dropdown-portal {
  /* Use fixed positioning but calculate position relative to nav */
  position: fixed !important;
  /* JavaScript will calculate these values based on nav-container position */
  top: var(--dropdown-top) !important;
  right: var(--dropdown-right) !important;
  z-index: 10000 !important;

  /* Enhanced backdrop-filter to match nav-container context */
  background: linear-gradient(135deg, rgba(0, 0, 0, 0.45) 0%, rgba(0, 0, 0, 0.35) 50%, rgba(0, 0, 0, 0.45) 100%);
  backdrop-filter: blur(20px) saturate(150%) brightness(110%); /* Match parent */
  -webkit-backdrop-filter: blur(20px) saturate(150%) brightness(110%);

  /* Additional blur layers for enhanced effect */
  filter: blur(0.5px);

  border: 1px solid rgba(255, 255, 255, 0.25);
  border-radius: 12px;
  box-shadow: 0 8px 40px rgba(0, 0, 0, 0.7), 0 4px 20px rgba(0, 0, 0, 0.5), 0 0 0 1px rgba(255, 255, 255, 0.1) inset;

  padding: 16px;
  min-width: 160px;
  width: max-content;
  overflow: hidden;

  transform: translateZ(0);
  will-change: backdrop-filter, transform;
}

/* DEBUGGING STYLES - Visual indicators for positioning analysis */
.debug-nav-container {
  outline: 2px solid red !important;
  outline-offset: -2px;
}

.debug-nav-container::before {
  content: "NAV-CONTAINER";
  position: absolute;
  top: -20px;
  left: 0;
  background: red;
  color: white;
  padding: 2px 6px;
  font-size: 10px;
  z-index: 10001;
}

.debug-mobile-dropdown {
  outline: 2px solid blue !important;
  outline-offset: -2px;
}

.debug-mobile-dropdown::before {
  content: "MOBILE-DROPDOWN";
  position: absolute;
  top: -20px;
  left: 0;
  background: blue;
  color: white;
  padding: 2px 6px;
  font-size: 10px;
  z-index: 1;
}

/* STACKING CONTEXT ANALYSIS */
.stacking-context-test {
  /* Test different stacking contexts */
  transform: translateZ(0); /* Creates stacking context */
  opacity: 0.99; /* Creates stacking context */
  filter: blur(0px); /* Creates stacking context */
  backdrop-filter: blur(0px); /* Creates stacking context */
  isolation: isolate; /* Creates stacking context */
}

/* BACKDROP-FILTER INHERITANCE TEST */
.backdrop-filter-test-parent {
  backdrop-filter: blur(20px);
  -webkit-backdrop-filter: blur(20px);
}

.backdrop-filter-test-child {
  backdrop-filter: inherit;
  -webkit-backdrop-filter: inherit;
  /* Additional effects */
  filter: blur(0.5px) saturate(120%);
}

/* RESPONSIVE POSITIONING SOLUTIONS */
@media (max-width: 768px) {
  .mobile-dropdown-solution-1,
  .mobile-dropdown-solution-2 {
    right: 16px !important;
    min-width: 140px;
  }

  .mobile-dropdown-portal {
    --dropdown-right: 16px;
  }
}

/* FALLBACK FOR BROWSERS WITHOUT BACKDROP-FILTER */
@supports not (backdrop-filter: blur(1px)) {
  .nav-container-solution-1,
  .nav-container-solution-2,
  .nav-container-solution-3 {
    background: rgba(0, 0, 0, 0.9);
  }

  .mobile-dropdown-solution-1,
  .mobile-dropdown-solution-2,
  .mobile-dropdown-portal {
    background: rgba(0, 0, 0, 0.95);
    filter: none;
  }
}
